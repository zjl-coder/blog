<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>解决npm link本地代码后 react库存在多份实例的问题 | 风时雨</title><meta name="description" content="风时雨博客">
    <link rel="modulepreload" href="/blog/assets/app.3e6ad282.js"><link rel="modulepreload" href="/blog/assets/npm-link-bug.html.9ac85472.js"><link rel="modulepreload" href="/blog/assets/npm-link-bug.html.5a2441b9.js"><link rel="prefetch" href="/blog/assets/index.html.cdfaa60a.js"><link rel="prefetch" href="/blog/assets/tool.html.8dd764e2.js"><link rel="prefetch" href="/blog/assets/index.html.3283b9d4.js"><link rel="prefetch" href="/blog/assets/sort.html.5903edd1.js"><link rel="prefetch" href="/blog/assets/index.html.cc890544.js"><link rel="prefetch" href="/blog/assets/index.html.10828445.js"><link rel="prefetch" href="/blog/assets/hot.html.6e18a770.js"><link rel="prefetch" href="/blog/assets/index.html.4b3c744d.js"><link rel="prefetch" href="/blog/assets/question1.html.60525f98.js"><link rel="prefetch" href="/blog/assets/url.html.ddb04915.js"><link rel="prefetch" href="/blog/assets/dns.html.d12f8ddd.js"><link rel="prefetch" href="/blog/assets/index.html.83e3a0fe.js"><link rel="prefetch" href="/blog/assets/csrf.html.a5476f7e.js"><link rel="prefetch" href="/blog/assets/csv.html.0ea3b1d6.js"><link rel="prefetch" href="/blog/assets/index.html.b1df9f14.js"><link rel="prefetch" href="/blog/assets/service.html.7a0be11f.js"><link rel="prefetch" href="/blog/assets/index.html.f00b0677.js"><link rel="prefetch" href="/blog/assets/1.html.31a77d53.js"><link rel="prefetch" href="/blog/assets/index.html.a1222905.js"><link rel="prefetch" href="/blog/assets/dart-and-runtime.html.e6beeed8.js"><link rel="prefetch" href="/blog/assets/index.html.b1b7cc96.js"><link rel="prefetch" href="/blog/assets/animation.html.40084b77.js"><link rel="prefetch" href="/blog/assets/bfc.html.fced76cd.js"><link rel="prefetch" href="/blog/assets/bigf.html.2ec8a352.js"><link rel="prefetch" href="/blog/assets/index.html.d1ba3eb8.js"><link rel="prefetch" href="/blog/assets/inline-block.html.d6d4db44.js"><link rel="prefetch" href="/blog/assets/rem.html.95b4c594.js"><link rel="prefetch" href="/blog/assets/ast.html.67958720.js"><link rel="prefetch" href="/blog/assets/babel.html.fda852c2.js"><link rel="prefetch" href="/blog/assets/engineering.html.72bd24bf.js"><link rel="prefetch" href="/blog/assets/error-monitor.html.2fc0272e.js"><link rel="prefetch" href="/blog/assets/es6toes5.html.f0b3d0a1.js"><link rel="prefetch" href="/blog/assets/git.html.d2379800.js"><link rel="prefetch" href="/blog/assets/hmr.html.5ae905a0.js"><link rel="prefetch" href="/blog/assets/index.html.8c7f4799.js"><link rel="prefetch" href="/blog/assets/npm-dangerous-act.html.454b6251.js"><link rel="prefetch" href="/blog/assets/optimize.html.929e30bd.js"><link rel="prefetch" href="/blog/assets/performance-monitor.html.0afb795a.js"><link rel="prefetch" href="/blog/assets/performance.html.feda1172.js"><link rel="prefetch" href="/blog/assets/record.html.fa69e186.js"><link rel="prefetch" href="/blog/assets/web.html.7cdb1217.js"><link rel="prefetch" href="/blog/assets/webpack-loader.html.1de8e04e.js"><link rel="prefetch" href="/blog/assets/webpack-plugin.html.bdd28a0e.js"><link rel="prefetch" href="/blog/assets/webpack.html.4e969916.js"><link rel="prefetch" href="/blog/assets/async.html.459a9eae.js"><link rel="prefetch" href="/blog/assets/bwbb.html.a24f9ba5.js"><link rel="prefetch" href="/blog/assets/click.html.5570728d.js"><link rel="prefetch" href="/blog/assets/cross-terminal.html.3d1afae3.js"><link rel="prefetch" href="/blog/assets/curry-partial.html.426a5e29.js"><link rel="prefetch" href="/blog/assets/d-ts.html.0f60ac21.js"><link rel="prefetch" href="/blog/assets/error.html.371e7d6e.js"><link rel="prefetch" href="/blog/assets/i18next.html.caaf92c2.js"><link rel="prefetch" href="/blog/assets/index.html.296f09f5.js"><link rel="prefetch" href="/blog/assets/promise.html.27dbf95d.js"><link rel="prefetch" href="/blog/assets/search-params.html.f0b3c4c9.js"><link rel="prefetch" href="/blog/assets/threejs.html.d97e6785.js"><link rel="prefetch" href="/blog/assets/closure-trap.html.74858778.js"><link rel="prefetch" href="/blog/assets/index.html.d0141e07.js"><link rel="prefetch" href="/blog/assets/react-0.html.a70a6bb2.js"><link rel="prefetch" href="/blog/assets/uncontrolled-components.html.dd3df6a9.js"><link rel="prefetch" href="/blog/assets/index.html.e0a9219b.js"><link rel="prefetch" href="/blog/assets/leader.html.32a07f08.js"><link rel="prefetch" href="/blog/assets/index.html.5606075f.js"><link rel="prefetch" href="/blog/assets/connection.html.a90231ca.js"><link rel="prefetch" href="/blog/assets/http.html.822c8e18.js"><link rel="prefetch" href="/blog/assets/index.html.3dd39eda.js"><link rel="prefetch" href="/blog/assets/index.html.1400a8ba.js"><link rel="prefetch" href="/blog/assets/shell.html.e9eeae3d.js"><link rel="prefetch" href="/blog/assets/index.html.5b0bfeca.js"><link rel="prefetch" href="/blog/assets/index.html.c1bda35c.js"><link rel="prefetch" href="/blog/assets/nginx.html.07d085e8.js"><link rel="prefetch" href="/blog/assets/buffer.html.f13abeb7.js"><link rel="prefetch" href="/blog/assets/http.html.46607c21.js"><link rel="prefetch" href="/blog/assets/index.html.61670ee9.js"><link rel="prefetch" href="/blog/assets/router.html.95eff585.js"><link rel="prefetch" href="/blog/assets/stream.html.435cc532.js"><link rel="prefetch" href="/blog/assets/index.html.4e91f1d5.js"><link rel="prefetch" href="/blog/assets/process-thread.html.740a17fb.js"><link rel="prefetch" href="/blog/assets/1.html.92429823.js"><link rel="prefetch" href="/blog/assets/10.html.4986434f.js"><link rel="prefetch" href="/blog/assets/11.html.d3c6b0f2.js"><link rel="prefetch" href="/blog/assets/2.html.28ecaa5e.js"><link rel="prefetch" href="/blog/assets/3.html.1d00c454.js"><link rel="prefetch" href="/blog/assets/4.html.50b14c0f.js"><link rel="prefetch" href="/blog/assets/5.html.4229c4a7.js"><link rel="prefetch" href="/blog/assets/6.html.437ede33.js"><link rel="prefetch" href="/blog/assets/7.html.148bf36d.js"><link rel="prefetch" href="/blog/assets/8.html.2932db88.js"><link rel="prefetch" href="/blog/assets/9.html.2f59b17a.js"><link rel="prefetch" href="/blog/assets/index.html.0780d923.js"><link rel="prefetch" href="/blog/assets/404.html.b4c6daf6.js"><link rel="prefetch" href="/blog/assets/index.html.c7f16056.js"><link rel="prefetch" href="/blog/assets/tool.html.227db393.js"><link rel="prefetch" href="/blog/assets/index.html.78bc70c1.js"><link rel="prefetch" href="/blog/assets/sort.html.71f6ad73.js"><link rel="prefetch" href="/blog/assets/index.html.40de4b70.js"><link rel="prefetch" href="/blog/assets/index.html.4525cd04.js"><link rel="prefetch" href="/blog/assets/hot.html.d847765b.js"><link rel="prefetch" href="/blog/assets/index.html.24ada3d5.js"><link rel="prefetch" href="/blog/assets/question1.html.a64bddd8.js"><link rel="prefetch" href="/blog/assets/url.html.a40990c6.js"><link rel="prefetch" href="/blog/assets/dns.html.3db56774.js"><link rel="prefetch" href="/blog/assets/index.html.34076ce3.js"><link rel="prefetch" href="/blog/assets/csrf.html.c9ee4c4b.js"><link rel="prefetch" href="/blog/assets/csv.html.49705ab7.js"><link rel="prefetch" href="/blog/assets/index.html.4ffdaa88.js"><link rel="prefetch" href="/blog/assets/service.html.6e395ceb.js"><link rel="prefetch" href="/blog/assets/index.html.880c09b8.js"><link rel="prefetch" href="/blog/assets/1.html.138bf630.js"><link rel="prefetch" href="/blog/assets/index.html.85a587b3.js"><link rel="prefetch" href="/blog/assets/dart-and-runtime.html.5ee0a30f.js"><link rel="prefetch" href="/blog/assets/index.html.20c44d0c.js"><link rel="prefetch" href="/blog/assets/animation.html.966abb37.js"><link rel="prefetch" href="/blog/assets/bfc.html.b0e9de2d.js"><link rel="prefetch" href="/blog/assets/bigf.html.e161c162.js"><link rel="prefetch" href="/blog/assets/index.html.178faddc.js"><link rel="prefetch" href="/blog/assets/inline-block.html.e21628dc.js"><link rel="prefetch" href="/blog/assets/rem.html.6b00cef0.js"><link rel="prefetch" href="/blog/assets/ast.html.7d560486.js"><link rel="prefetch" href="/blog/assets/babel.html.934d1744.js"><link rel="prefetch" href="/blog/assets/engineering.html.618a56f7.js"><link rel="prefetch" href="/blog/assets/error-monitor.html.7f95deb2.js"><link rel="prefetch" href="/blog/assets/es6toes5.html.ef54ebf9.js"><link rel="prefetch" href="/blog/assets/git.html.dc5b2311.js"><link rel="prefetch" href="/blog/assets/hmr.html.fa094a4a.js"><link rel="prefetch" href="/blog/assets/index.html.40d9d539.js"><link rel="prefetch" href="/blog/assets/npm-dangerous-act.html.1b39c85f.js"><link rel="prefetch" href="/blog/assets/optimize.html.9e0893ac.js"><link rel="prefetch" href="/blog/assets/performance-monitor.html.6bb2fa89.js"><link rel="prefetch" href="/blog/assets/performance.html.f7db20b1.js"><link rel="prefetch" href="/blog/assets/record.html.2979a23f.js"><link rel="prefetch" href="/blog/assets/web.html.d69ceb0d.js"><link rel="prefetch" href="/blog/assets/webpack-loader.html.61a8a080.js"><link rel="prefetch" href="/blog/assets/webpack-plugin.html.7525b562.js"><link rel="prefetch" href="/blog/assets/webpack.html.6d35e242.js"><link rel="prefetch" href="/blog/assets/async.html.63e49dac.js"><link rel="prefetch" href="/blog/assets/bwbb.html.493e6581.js"><link rel="prefetch" href="/blog/assets/click.html.b51938ee.js"><link rel="prefetch" href="/blog/assets/cross-terminal.html.3510ae89.js"><link rel="prefetch" href="/blog/assets/curry-partial.html.63756711.js"><link rel="prefetch" href="/blog/assets/d-ts.html.f7001e13.js"><link rel="prefetch" href="/blog/assets/error.html.3ef6dd58.js"><link rel="prefetch" href="/blog/assets/i18next.html.74aa1b2c.js"><link rel="prefetch" href="/blog/assets/index.html.49f6b9ef.js"><link rel="prefetch" href="/blog/assets/promise.html.e179fa48.js"><link rel="prefetch" href="/blog/assets/search-params.html.e5cec4a1.js"><link rel="prefetch" href="/blog/assets/threejs.html.a7fe9558.js"><link rel="prefetch" href="/blog/assets/closure-trap.html.f58cbfb8.js"><link rel="prefetch" href="/blog/assets/index.html.b4cce446.js"><link rel="prefetch" href="/blog/assets/react-0.html.b87813ea.js"><link rel="prefetch" href="/blog/assets/uncontrolled-components.html.5198c871.js"><link rel="prefetch" href="/blog/assets/index.html.2c8047c1.js"><link rel="prefetch" href="/blog/assets/leader.html.8e438dda.js"><link rel="prefetch" href="/blog/assets/index.html.17c6dbd8.js"><link rel="prefetch" href="/blog/assets/connection.html.0bdeea7f.js"><link rel="prefetch" href="/blog/assets/http.html.0ac7400d.js"><link rel="prefetch" href="/blog/assets/index.html.1f3918df.js"><link rel="prefetch" href="/blog/assets/index.html.c5173026.js"><link rel="prefetch" href="/blog/assets/shell.html.7b8c1800.js"><link rel="prefetch" href="/blog/assets/index.html.3a3f0977.js"><link rel="prefetch" href="/blog/assets/index.html.7daf3547.js"><link rel="prefetch" href="/blog/assets/nginx.html.33679f9b.js"><link rel="prefetch" href="/blog/assets/buffer.html.df8033a1.js"><link rel="prefetch" href="/blog/assets/http.html.317cfe35.js"><link rel="prefetch" href="/blog/assets/index.html.e4165741.js"><link rel="prefetch" href="/blog/assets/router.html.b66e02eb.js"><link rel="prefetch" href="/blog/assets/stream.html.03f7965a.js"><link rel="prefetch" href="/blog/assets/index.html.a70ebc20.js"><link rel="prefetch" href="/blog/assets/process-thread.html.b6ee680e.js"><link rel="prefetch" href="/blog/assets/1.html.14cb061a.js"><link rel="prefetch" href="/blog/assets/10.html.a68761db.js"><link rel="prefetch" href="/blog/assets/11.html.1049c651.js"><link rel="prefetch" href="/blog/assets/2.html.100ce147.js"><link rel="prefetch" href="/blog/assets/3.html.61b4f626.js"><link rel="prefetch" href="/blog/assets/4.html.4b91bf72.js"><link rel="prefetch" href="/blog/assets/5.html.817cc397.js"><link rel="prefetch" href="/blog/assets/6.html.9516882c.js"><link rel="prefetch" href="/blog/assets/7.html.faf8eb50.js"><link rel="prefetch" href="/blog/assets/8.html.a278b7e1.js"><link rel="prefetch" href="/blog/assets/9.html.9bc0b049.js"><link rel="prefetch" href="/blog/assets/index.html.41f6b19f.js"><link rel="prefetch" href="/blog/assets/404.html.661cb78d.js"><link rel="prefetch" href="/blog/assets/404.1c599e24.js"><link rel="prefetch" href="/blog/assets/Layout.1339d851.js"><link rel="prefetch" href="/blog/assets/Crypto.95f71dbe.js"><link rel="prefetch" href="/blog/assets/HomeBackground.adc1d3db.js"><link rel="prefetch" href="/blog/assets/Mind.af45d289.js"><link rel="prefetch" href="/blog/assets/Office.e0454c8f.js"><link rel="prefetch" href="/blog/assets/Pdf.15846192.js"><link rel="prefetch" href="/blog/assets/Te.7b8da068.js"><link rel="prefetch" href="/blog/assets/TitleList.e93d3a28.js">
    <link rel="stylesheet" href="/blog/assets/style.c992ffc8.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog/" class=""><!----><span class="site-name">风时雨</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="风雨夜航"><span class="title">风雨夜航</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="风雨夜航"><span class="title">风雨夜航</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/front/" class="router-link-active" aria-label="前端"><!--[--><!--]--> 前端 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/server/" class="" aria-label="服务端"><!--[--><!--]--> 服务端 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/network/" class="" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/app/" class="" aria-label="应用端"><!--[--><!--]--> 应用端 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/blog/safe/" class="" aria-label="安全"><!--[--><!--]--> 安全 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="面试题"><span class="title">面试题</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="面试题"><span class="title">面试题</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/interview_questions/" class="" aria-label="八股文"><!--[--><!--]--> 八股文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://zjl-coder.github.io/design-pattern/" rel="noopener noreferrer" target="_blank" aria-label="设计模式"><!--[--><!--]--> 设计模式 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/algorithm/" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/blog/tool.md" class="" aria-label="工具"><!--[--><!--]--> 工具 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="风雨夜航"><span class="title">风雨夜航</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="风雨夜航"><span class="title">风雨夜航</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/front/" class="router-link-active" aria-label="前端"><!--[--><!--]--> 前端 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/server/" class="" aria-label="服务端"><!--[--><!--]--> 服务端 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/network/" class="" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/app/" class="" aria-label="应用端"><!--[--><!--]--> 应用端 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/blog/safe/" class="" aria-label="安全"><!--[--><!--]--> 安全 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="面试题"><span class="title">面试题</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="面试题"><span class="title">面试题</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/interview_questions/" class="" aria-label="八股文"><!--[--><!--]--> 八股文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://zjl-coder.github.io/design-pattern/" rel="noopener noreferrer" target="_blank" aria-label="设计模式"><!--[--><!--]--> 设计模式 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/algorithm/" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/blog/tool.md" class="" aria-label="工具"><!--[--><!--]--> 工具 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/blog/front/" class="router-link-active sidebar-item sidebar-heading active" aria-label="前端"><!--[--><!--]--> 前端 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/front/work" class="sidebar-item" aria-label="职业"><!--[--><!--]--> 职业 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/work/leader.md" class="sidebar-item" aria-label="前端Leader的任务"><!--[--><!--]--> 前端Leader的任务 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/js" class="sidebar-item" aria-label="js"><!--[--><!--]--> js <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/front/js/bwbb.md" class="sidebar-item" aria-label="browserify、webpack、babel、browserslist"><!--[--><!--]--> browserify、webpack、babel、browserslist <!--[--><!--]--></a><!----></li><li><a href="/blog/front/js/error.md" class="sidebar-item" aria-label="JavaScript中的Error类型"><!--[--><!--]--> JavaScript中的Error类型 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/js/search-params.md" class="sidebar-item" aria-label="获取URL get参数"><!--[--><!--]--> 获取URL get参数 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/js/promise.md" class="sidebar-item" aria-label="promise执行流程"><!--[--><!--]--> promise执行流程 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/js/async.md" class="sidebar-item" aria-label="async await 执行流程"><!--[--><!--]--> async await 执行流程 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/js/curry-partial.md" class="sidebar-item" aria-label="柯里化与局部应用"><!--[--><!--]--> 柯里化与局部应用 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/js/click.md" class="sidebar-item" aria-label="click回调的异步与同步"><!--[--><!--]--> click回调的异步与同步 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/js/threejs.md" class="sidebar-item" aria-label="three.js"><!--[--><!--]--> three.js <!--[--><!--]--></a><!----></li><li><a href="/blog/front/js/d-ts.md" class="sidebar-item" aria-label="*.d.ts全局类型声明"><!--[--><!--]--> *.d.ts全局类型声明 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/js/cross-terminal.md" class="sidebar-item" aria-label="跨端技术的本质与现状"><!--[--><!--]--> 跨端技术的本质与现状 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/js/i18next.md" class="sidebar-item" aria-label="i18next"><!--[--><!--]--> i18next <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/blog/front/css" class="sidebar-item" aria-label="css"><!--[--><!--]--> css <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/front/css/bfc.md" class="sidebar-item" aria-label="BFC、浮动float、clear"><!--[--><!--]--> BFC、浮动float、clear <!--[--><!--]--></a><!----></li><li><a href="/blog/front/css/bigf.md" class="sidebar-item" aria-label="BFC、IFC、GFC、FFC"><!--[--><!--]--> BFC、IFC、GFC、FFC <!--[--><!--]--></a><!----></li><li><a href="/blog/front/css/rem.md" class="sidebar-item" aria-label="rem移动端适配"><!--[--><!--]--> rem移动端适配 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/css/animation.md" class="sidebar-item" aria-label="动画函数区分"><!--[--><!--]--> 动画函数区分 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/css/inline-block.md" class="sidebar-item" aria-label="inline-block 元素下移现象"><!--[--><!--]--> inline-block 元素下移现象 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/blog/front/react" class="router-link-active sidebar-item active" aria-label="react"><!--[--><!--]--> react <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/front/react/uncontrolled-components.md" class="sidebar-item" aria-label="非受控组件 react"><!--[--><!--]--> 非受控组件 react <!--[--><!--]--></a><!----></li><li><a href="/blog/front/react/react-0.md" class="sidebar-item" aria-label="react渲染出0的问题"><!--[--><!--]--> react渲染出0的问题 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/react/closure-trap.md" class="sidebar-item" aria-label="组件函数的闭包陷阱"><!--[--><!--]--> 组件函数的闭包陷阱 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/react/npm-link-bug.md" class="sidebar-item active" aria-label="npm link导致react库存在多实例"><!--[--><!--]--> npm link导致react库存在多实例 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/blog/front/engineering" class="sidebar-item" aria-label="工程"><!--[--><!--]--> 工程 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/front/engineering/webpack.md" class="sidebar-item" aria-label="Webpack基本知识"><!--[--><!--]--> Webpack基本知识 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/webpack-plugin.md" class="sidebar-item" aria-label="webpack plugin插件"><!--[--><!--]--> webpack plugin插件 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/webpack-loader.md" class="sidebar-item" aria-label="webpack loader"><!--[--><!--]--> webpack loader <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/hmr.md" class="sidebar-item" aria-label="Webpack热更新原理解析"><!--[--><!--]--> Webpack热更新原理解析 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/ast.md" class="sidebar-item" aria-label="AST抽象语法树"><!--[--><!--]--> AST抽象语法树 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/babel.md" class="sidebar-item" aria-label="Babel基本知识"><!--[--><!--]--> Babel基本知识 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/es6toes5.md" class="sidebar-item" aria-label="es6模块化代码转es5代码的模样"><!--[--><!--]--> es6模块化代码转es5代码的模样 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/engineering.md" class="sidebar-item" aria-label="前端工程化"><!--[--><!--]--> 前端工程化 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/error-monitor.md" class="sidebar-item" aria-label="前端错误监控"><!--[--><!--]--> 前端错误监控 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/performance-monitor.md" class="sidebar-item" aria-label="前端性能监控"><!--[--><!--]--> 前端性能监控 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/performance.md" class="sidebar-item" aria-label="性能指标"><!--[--><!--]--> 性能指标 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/optimize.md" class="sidebar-item" aria-label="前端优化方案"><!--[--><!--]--> 前端优化方案 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/web.md" class="sidebar-item" aria-label="对web项目的思考"><!--[--><!--]--> 对web项目的思考 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/git.md" class="sidebar-item" aria-label="git常用命令"><!--[--><!--]--> git常用命令 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/npm-dangerous-act.md" class="sidebar-item" aria-label="npm和yarn的危险行为"><!--[--><!--]--> npm和yarn的危险行为 <!--[--><!--]--></a><!----></li><li><a href="/blog/front/engineering/record.md" class="sidebar-item" aria-label="录屏与源码定位"><!--[--><!--]--> 录屏与源码定位 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/blog/server/" class="sidebar-item sidebar-heading" aria-label="服务端"><!--[--><!--]--> 服务端 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/server/node/" class="sidebar-item" aria-label="node"><!--[--><!--]--> node <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/server/node/buffer.md" class="sidebar-item" aria-label="理解node buffer"><!--[--><!--]--> 理解node buffer <!--[--><!--]--></a><!----></li><li><a href="/blog/server/node/http.md" class="sidebar-item" aria-label="理解node http"><!--[--><!--]--> 理解node http <!--[--><!--]--></a><!----></li><li><a href="/blog/server/node/router.md" class="sidebar-item" aria-label="理解node router路由中间件的原理"><!--[--><!--]--> 理解node router路由中间件的原理 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/node/stream.md" class="sidebar-item" aria-label="理解node stream流"><!--[--><!--]--> 理解node stream流 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/blog/server/nginx/" class="sidebar-item" aria-label="nginx"><!--[--><!--]--> nginx <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/server/nginx/nginx.md" class="sidebar-item" aria-label="前端nginx知识"><!--[--><!--]--> 前端nginx知识 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/blog/server/system/" class="sidebar-item" aria-label="系统"><!--[--><!--]--> 系统 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/server/system/process-thread.md" class="sidebar-item" aria-label="进程和线程"><!--[--><!--]--> 进程和线程 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/blog/server/docker/" class="sidebar-item" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/server/docker/shell.md" class="sidebar-item" aria-label="docker shell 自动化脚本"><!--[--><!--]--> docker shell 自动化脚本 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/blog/server/k8s/" class="sidebar-item" aria-label="Kubernetes"><!--[--><!--]--> Kubernetes <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/server/k8s/index.md" class="sidebar-item" aria-label="Kubernetes 架构"><!--[--><!--]--> Kubernetes 架构 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/blog/network/" class="sidebar-item sidebar-heading" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/network/tcp" class="sidebar-item" aria-label="tcp"><!--[--><!--]--> tcp <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/network/tcp/connection.md" class="sidebar-item" aria-label="HTTP长连接、短连接和websocket"><!--[--><!--]--> HTTP长连接、短连接和websocket <!--[--><!--]--></a><!----></li><li><a href="/blog/network/tcp/http.md" class="sidebar-item" aria-label="HTTP教程"><!--[--><!--]--> HTTP教程 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/blog/network/dns.md" class="sidebar-item" aria-label="DNS解析过程"><!--[--><!--]--> DNS解析过程 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/blog/app/" class="sidebar-item sidebar-heading" aria-label="应用端"><!--[--><!--]--> 应用端 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/app/dart" class="sidebar-item" aria-label="dart和runtime(运行时)"><!--[--><!--]--> dart和runtime(运行时) <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/app/dart/dart-and-runtime.md" class="sidebar-item" aria-label="dart和runtime(运行时)"><!--[--><!--]--> dart和runtime(运行时) <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><div class="titlelist" data-v-709ce347><!--[--><!--]--></div><h1 id="解决npm-link本地代码后-react库存在多份实例的问题" tabindex="-1"><a class="header-anchor" href="#解决npm-link本地代码后-react库存在多份实例的问题" aria-hidden="true">#</a> 解决npm link本地代码后 react库存在多份实例的问题</h1><h3 id="非法hook调用错误" tabindex="-1"><a class="header-anchor" href="#非法hook调用错误" aria-hidden="true">#</a> 非法Hook调用错误</h3><p>在调试本地组件库代码时，<strong>link</strong>到主项目时<strong>报错</strong>了如下错误</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Error: Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons: 
1. You might have mismatching versions of React and the renderer (such as React DOM) 
2. You might be breaking the Rules of Hooks 
3. You might have more than one copy of React in the same app See https://fb.me/react-invalid-hook-call for tips about how to debug and fix this problem.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是将代码发布到本地仓库后，<strong>install下来是不会有问题的</strong>。</p><h3 id="报错原因" tabindex="-1"><a class="header-anchor" href="#报错原因" aria-hidden="true">#</a> 报错原因</h3><p>React官方文档上解释了这个原因。</p><blockquote><p>为了使 Hook 正常工作，你应用代码中的 react 依赖以及 react-dom 的 package 内部使用的 react 依赖，必须解析为同一个模块。</p></blockquote><p>也就是说，在你的应用里找到了两份react实例，并且react-dom中引用的react实例与直接import的react实例<strong>不是同一份</strong>。对应到我报错的场景里，就是link到本地组件库时，组件库中import了一份react-dom, 而这一份react-dom引用的react实例，是<strong>本地组件库中安装的react实例</strong>。而非<strong>主应用中安装的那一份react实例</strong>。</p><h3 id="为什么npm-install-没有问题-npm-link有问题" tabindex="-1"><a class="header-anchor" href="#为什么npm-install-没有问题-npm-link有问题" aria-hidden="true">#</a> 为什么npm install 没有问题，npm link有问题</h3><p>npm install在安装依赖的时候，会合并相同依赖，安装在最外层的node_modules中。所以只有一份依赖。而npm link是直接引用本地目录，本地目录的node_modules会和主项目的node_modules同时存在两份相同的引用。</p><h3 id="怎么解决这个问题" tabindex="-1"><a class="header-anchor" href="#怎么解决这个问题" aria-hidden="true">#</a> 怎么解决这个问题</h3><p>要解决这个问题，就需要将组件库react-dom依赖的react指向主项目node_modules中安装的那一份react实例。我们可以通过两种方式来完成这个操作。</p><ul><li><strong>使用link的方式将组件库的react依赖指向到主项目的react依赖</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 进入本地 npm 包根目录</span>
<span class="token builtin class-name">cd</span> <span class="token punctuation">[</span>PACKAGE<span class="token punctuation">]</span>
<span class="token comment"># 将依赖的react link 为我们主项目的react包</span>
<span class="token function">npm</span> <span class="token function">link</span> <span class="token punctuation">[</span>PROJECT<span class="token punctuation">]</span>/node_modules/react
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>使用alias为Nodejs指定react加载目录</strong></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// /build/wepack.base.config.js</span>
<span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">react</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../node_modules/react&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="官方解释" tabindex="-1"><a class="header-anchor" href="#官方解释" aria-hidden="true">#</a> 官方解释</h3><p><a href="https://zh-hans.legacy.reactjs.org/warnings/invalid-hook-call-warning.html#duplicate-react" target="_blank" rel="noopener noreferrer">React官网警告：非法 Hook 调用<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog/assets/app.3e6ad282.js" defer></script>
  </body>
</html>
